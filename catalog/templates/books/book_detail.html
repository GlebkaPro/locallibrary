{% extends "base_generic.html" %}

{% block content %}
  <div class="d-flex justify-content-center">
    <div class="card">
      <div class="card-body">
        <div class="container">
          {% if user.is_staff %}
            <div style="display: flex; gap: 8px; margin-top: 8px; margin-bottom: 8px;">
              <form method="get" action="{% url 'edit-book' book_id=book.id %}">
                <button type="submit" class="btn btn-primary">Редактировать</button>
              </form>
              <form method="get" action="{% url 'delete-book' book_id=book.id %}">
                <button type="submit" class="btn btn-danger">Удалить</button>
              </form>
            </div>
          {% endif %}
          <h0 class="card-title">Название: {{ book.title }}</h0>
          <h5><a
            href="{{ book.author.get_absolute_url }}">{{ book.author.last_name }} {{ book.author.first_name }} {{ book.author.middle_name }}</a>
          </h5>
          <div class="book-info card">
            <div class="d-flex flex-row">
              <div class="image-container order-first">
                {% if book.image %}
                  <img src="{{ book.image.url }}" class="card-img-top img-fluid" alt="Book Image"
                       style="width: 300px; height: 100%;">
                {% endif %}
              </div>
              <div class="text-container card-body order-last">
                <p class="card-text"><strong>Описание: </strong>{{ book.summary }}</p>
                <p class="card-text"><strong>Язык: </strong>{{ book.language }}</p>
                <p class="card-text"><strong>Жанр: </strong>{{ book.genre.all|join:", " }}</p>
              </div>
              <div class="text-container card-body order-last">
                <p class="card-text">Всего копий (шт.): {{ book.bookcopy_set.all.count }}</p>
                <p class="card-text">Доступно экземпляров (шт.): {{ book.available_copies_count }}</p>
                <form method="get" action="{% url 'reserve-book' book_id=book.id %}">
                  {% if user.is_authenticated %}
                    <button type="submit" class="btn btn-primary" style="margin-top: 10px">Зарезервировать книгу</button>
                  {% endif %}
                  {% if messages %}
                    <ul class="messages">
                      {% for message in messages %}
                        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                          {% if message.tags == 'success' %}
                            <div class="alert alert-success" role="alert">{{ message }}</div>
                          {% elif message.tags == 'error' %}
                            <div class="alert alert-danger" role="alert">{{ message }}</div>
                          {% else %}
                            {{ message }}
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </form>
              </div>

            </div>
          </div>
          <div class="card" style="margin-top: 16px">
            {% if user.is_staff %}
              <h4>Статусы экземпляров:</h4>
              {% for copy in book.bookcopy_set.all %}
                <hr>
                <h5>№ {{ forloop.counter }}</h5>
                <p
                  class="{% if copy.status == 'д' %}text-success{% elif copy.status == 'р' %}text-danger{% else %}text-warning{% endif %}">
                  <strong>Статус: </strong>{{ copy.get_status_display }}</p>
                {% if user.is_staff %}
                  <p class="text-muted"><strong>Штамп:</strong> {{ copy.imprint }}</p>
                {% endif %}
              {% endfor %}
              </div>
              </div>
              </div>
              </div>
              </div>
            {% endif %}

  <style>
    .book-info {
      display: flex;
    }

    .image-container {
      margin-right: 10px;
    }

    .text-container {
      flex: 1;
      align-items: flex-start;
    }

    .card {
      border-radius: 10px;
      background-color: #f5f5f5;
      padding: 10px;
    }

    .card-title {
      font-size: 20px;
      font-weight: bold;
    }

    .card-subtitle {
      font-size: 16px;
    }

    .card-text {
      font-size: 18px;
    }
  </style>
{% endblock %}